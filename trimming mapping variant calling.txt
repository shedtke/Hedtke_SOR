#!/bin/bash
#SBATCH --time=08:00:00
#SBATCH --partition=compute
#SBATCH --nodes=1
#SBATCH --mem-per-cpu=16384

module load trimmomatic/0.32
module load samtools-gcc/1.2
module load bwa-intel/0.7.12
module load gatk/3.3_0
module load picard/1.115

## variables to specify
REF=Ov_wOv_refs.fa
SEQCTR=sequencing_center
LIB="nebnextultra"
genomes="Ov3_mtOv_wOv"

bwa index $REF
samtools faidx $REF
java -jar CreateSequenceDictionary.jar REFERENCE=$REF OUTPUT=Ov_wOv.refs.dict

ID="OV01
OV02
OV03
OV04
OV05
"

for i in $ID
do
echo "trimming $i"
trimmomatic PE -threads 2 -phred33 -trimlog $i\.trim.log $i\_R1.fastq $i\_R2.fastq -baseout $i\.trimmed.fq ILLUMINACLIP:NexteraPE-PE.fa:2:30:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:75

echo "mapping $i to $REF"
bwa mem $REF -M -t 8 -R '@RG\tID:$i\tCN:$SEQCTR\tLB:$LIB\tSM:$i\tPL:ILLUMINA' $i_1P.fq.gz $i_2P.fq.gz | samtools view -bh - | samtools sort -> $i\.$genomes\.sorted.bam

echo "mapping stats $i sorted"
samtools flagstat $i\.$genomes\.sorted.bam

echo "removing duplicates $i"
java -jar /usr/local/picard/1.115/lib/MarkDuplicates.jar I=$i\.$genomes\.sorted.bam O=$i\.$genomes\.dedup.bam M=$i\.$genomes\.metrics REMOVE_DUPLICATES=true

echo "extracting nuc from $i\.$genomes\.dedup.bam..."
samtools view -hb OV60.ASU.6.8.bwa.dedup.bam OVOC_OM1a OVOC_OM1b OVOC_OM2 OVOC_OM3 OVOC_OM4 OVOC_OM5 OVOC_OO_000001 OVOC_OO_000002 OVOC_OO_000003 OVOC_OO_000004 OVOC_OO_000005 OVOC_OO_000006 OVOC_OO_000007 OVOC_OO_000008 OVOC_OO_000009 OVOC_OO_000010 OVOC_OO_000011 OVOC_OO_000012 OVOC_OO_000013 OVOC_OO_000014 OVOC_OO_000015 OVOC_OO_000016 OVOC_OO_000017 OVOC_OO_000018 OVOC_OO_000019 OVOC_OO_000020 OVOC_OO_000021 OVOC_OO_000022 OVOC_OO_000023 OVOC_OO_000024 OVOC_OO_000025 OVOC_OO_000026 OVOC_OO_000027 OVOC_OO_000028 OVOC_OO_000029 OVOC_OO_000031 OVOC_OO_000032 OVOC_OO_000033 OVOC_OO_000034 OVOC_OO_000035 OVOC_OO_000036 OVOC_OO_000037 OVOC_OO_000038 OVOC_OO_000039 OVOC_OO_000040 OVOC_OO_000041 OVOC_OO_000042 OVOC_OO_000043 OVOC_OO_000044 OVOC_OO_000045 OVOC_OO_000046 OVOC_OO_000047 OVOC_OO_000048 OVOC_OO_000049 OVOC_OO_000050 OVOC_OO_000051 OVOC_OO_000052 OVOC_OO_000053 OVOC_OO_000054 OVOC_OO_000055 OVOC_OO_000056 OVOC_OO_000057 OVOC_OO_000058 OVOC_OO_000059 OVOC_OO_000060 OVOC_OO_000061 OVOC_OO_000062 OVOC_OO_000063 OVOC_OO_000064 OVOC_OO_000065 OVOC_OO_000066 OVOC_OO_000067 OVOC_OO_000068 OVOC_OO_000069 OVOC_OO_000070 OVOC_OO_000071 OVOC_OO_000072 OVOC_OO_000073 OVOC_OO_000074 OVOC_OO_000075 OVOC_OO_000076 OVOC_OO_000077 OVOC_OO_000078 OVOC_OO_000079 OVOC_OO_000080 OVOC_OO_000081 OVOC_OO_000082 OVOC_OO_000083 OVOC_OO_000084 OVOC_OO_000085 OVOC_OO_000086 OVOC_OO_000087 OVOC_OO_000088 OVOC_OO_000089 OVOC_OO_000090 OVOC_OO_000091 OVOC_OO_000092 OVOC_OO_000093 OVOC_OO_000094 OVOC_OO_000095 OVOC_OO_000096 OVOC_OO_000097 OVOC_OO_000098 OVOC_OO_000099 OVOC_OO_000100 OVOC_OO_000101 OVOC_OO_000102 OVOC_OO_000103 OVOC_OO_000104 OVOC_OO_000105 OVOC_OO_000106 OVOC_OO_000107 OVOC_OO_000108 OVOC_OO_000109 OVOC_OO_000110 OVOC_OO_000111 OVOC_OO_000112 OVOC_OO_000113 OVOC_OO_000114 OVOC_OO_000115 OVOC_OO_000116 OVOC_OO_000117 OVOC_OO_000118 OVOC_OO_000119 OVOC_OO_000120 OVOC_OO_000121 OVOC_OO_000122 OVOC_OO_000123 OVOC_OO_000124 OVOC_OO_000125 OVOC_OO_000126 OVOC_OO_000127 OVOC_OO_000128 OVOC_OO_000129 OVOC_OO_000130 OVOC_OO_000131 OVOC_OO_000132 OVOC_OO_000133 OVOC_OO_000134 OVOC_OO_000135 OVOC_OO_000136 OVOC_OO_000137 OVOC_OO_000138 OVOC_OO_000139 OVOC_OO_000140 OVOC_OO_000141 OVOC_OO_000142 OVOC_OO_000143 OVOC_OO_000144 OVOC_OO_000145 OVOC_OO_000146 OVOC_OO_000147 OVOC_OO_000148 OVOC_OO_000149 OVOC_OO_000150 OVOC_OO_000151 OVOC_OO_000152 OVOC_OO_000153 OVOC_OO_000154 OVOC_OO_000155 OVOC_OO_000156 OVOC_OO_000157 OVOC_OO_000158 OVOC_OO_000159 OVOC_OO_000160 OVOC_OO_000161 OVOC_OO_000162 OVOC_OO_000163 OVOC_OO_000164 OVOC_OO_000165 OVOC_OO_000166 OVOC_OO_000167 OVOC_OO_000168 OVOC_OO_000169 OVOC_OO_000170 OVOC_OO_000171 OVOC_OO_000172 OVOC_OO_000173 OVOC_OO_000174 OVOC_OO_000175 OVOC_OO_000176 OVOC_OO_000177 OVOC_OO_000178 OVOC_OO_000179 OVOC_OO_000180 OVOC_OO_000181 OVOC_OO_000182 OVOC_OO_000183 OVOC_OO_000184 OVOC_OO_000185 OVOC_OO_000186 OVOC_OO_000187 OVOC_OO_000188 OVOC_OO_000189 OVOC_OO_000190 OVOC_OO_000191 OVOC_OO_000192 OVOC_OO_000193 OVOC_OO_000194 OVOC_OO_000195 OVOC_OO_000196 OVOC_OO_000198 OVOC_OO_000199 OVOC_OO_000200 OVOC_OO_000201 OVOC_OO_000202 OVOC_OO_000203 OVOC_OO_000204 OVOC_OO_000205 OVOC_OO_000206 OVOC_OO_000207 OVOC_OO_000208 OVOC_OO_000209 OVOC_OO_000210 OVOC_OO_000211 OVOC_OO_000212 OVOC_OO_000213 OVOC_OO_000214 OVOC_OO_000215 OVOC_OO_000216 OVOC_OO_000217 OVOC_OO_000218 OVOC_OO_000219 OVOC_OO_000220 OVOC_OO_000221 OVOC_OO_000222 OVOC_OO_000223 OVOC_OO_000224 OVOC_OO_000225 OVOC_OO_000226 OVOC_OO_000227 OVOC_OO_000228 OVOC_OO_000229 OVOC_OO_000230 OVOC_OO_000231 OVOC_OO_000232 OVOC_OO_000233 OVOC_OO_000234 OVOC_OO_000235 OVOC_OO_000236 OVOC_OO_000237 OVOC_OO_000238 OVOC_OO_000239 OVOC_OO_000240 OVOC_OO_000241 OVOC_OO_000242 OVOC_OO_000243 OVOC_OO_000244 OVOC_OO_000245 OVOC_OO_000246 OVOC_OO_000247 OVOC_OO_000248 OVOC_OO_000249 OVOC_OO_000250 OVOC_OO_000251 OVOC_OO_000252 OVOC_OO_000253 OVOC_OO_000254 OVOC_OO_000255 OVOC_OO_000256 OVOC_OO_000257 OVOC_OO_000258 OVOC_OO_000259 OVOC_OO_000260 OVOC_OO_000261 OVOC_OO_000262 OVOC_OO_000263 OVOC_OO_000264 OVOC_OO_000265 OVOC_OO_000266 OVOC_OO_000267 OVOC_OO_000268 OVOC_OO_000269 OVOC_OO_000270 OVOC_OO_000271 OVOC_OO_000272 OVOC_OO_000273 OVOC_OO_000274 OVOC_OO_000275 OVOC_OO_000276 OVOC_OO_000277 OVOC_OO_000278 OVOC_OO_000279 OVOC_OO_000280 OVOC_OO_000281 OVOC_OO_000282 OVOC_OO_000283 OVOC_OO_000284 OVOC_OO_000285 OVOC_OO_000286 OVOC_OO_000287 OVOC_OO_000288 OVOC_OO_000289 OVOC_OO_000290 OVOC_OO_000291 OVOC_OO_000292 OVOC_OO_000293 OVOC_OO_000294 OVOC_OO_000295 OVOC_OO_000296 OVOC_OO_000297 OVOC_OO_000298 OVOC_OO_000299 OVOC_OO_000300 OVOC_OO_000301 OVOC_OO_000302 OVOC_OO_000303 OVOC_OO_000304 OVOC_OO_000305 OVOC_OO_000306 OVOC_OO_000307 OVOC_OO_000308 OVOC_OO_000309 OVOC_OO_000310 OVOC_OO_000311 OVOC_OO_000312 OVOC_OO_000313 OVOC_OO_000314 OVOC_OO_000315 OVOC_OO_000316 OVOC_OO_000317 OVOC_OO_000318 OVOC_OO_000319 OVOC_OO_000320 OVOC_OO_000321 OVOC_OO_000322 OVOC_OO_000323 OVOC_OO_000324 OVOC_OO_000325 OVOC_OO_000326 OVOC_OO_000327 OVOC_OO_000328 OVOC_OO_000329 OVOC_OO_000330 OVOC_OO_000331 OVOC_OO_000332 OVOC_OO_000333 OVOC_OO_000334 OVOC_OO_000335 OVOC_OO_000336 OVOC_OO_000337 OVOC_OO_000338 OVOC_OO_000339 OVOC_OO_000340 OVOC_OO_000341 OVOC_OO_000342 OVOC_OO_000343 OVOC_OO_000344 OVOC_OO_000345 OVOC_OO_000346 OVOC_OO_000347 OVOC_OO_000348 OVOC_OO_000349 OVOC_OO_000350 OVOC_OO_000351 OVOC_OO_000352 OVOC_OO_000353 OVOC_OO_000354 OVOC_OO_000355 OVOC_OO_000356 OVOC_OO_000357 OVOC_OO_000358 OVOC_OO_000359 OVOC_OO_000360 OVOC_OO_000361 OVOC_OO_000362 OVOC_OO_000363 OVOC_OO_000364 OVOC_OO_000365 OVOC_OO_000366 OVOC_OO_000367 OVOC_OO_000369 OVOC_OO_000370 OVOC_OO_000371 OVOC_OO_000372 OVOC_OO_000373 OVOC_OO_000374 OVOC_OO_000375 OVOC_OO_000376 OVOC_OO_000377 OVOC_OO_000378 OVOC_OO_000379 OVOC_OO_000380 OVOC_OO_000381 OVOC_OO_000382 OVOC_OO_000383 OVOC_OO_000384 OVOC_OO_000385 OVOC_OO_000386 OVOC_OO_000387 OVOC_OO_000388 OVOC_OO_000389 OVOC_OO_000390 OVOC_OO_000391 OVOC_OO_000392 OVOC_OO_000393 OVOC_OO_000394 OVOC_OO_000395 OVOC_OO_000397 OVOC_OO_000398 OVOC_OO_000399 OVOC_OO_000400 OVOC_OO_000401 OVOC_OO_000402 OVOC_OO_000403 OVOC_OO_000404 OVOC_OO_000405 OVOC_OO_000406 OVOC_OO_000407 OVOC_OO_000408 OVOC_OO_000409 OVOC_OO_000410 OVOC_OO_000411 OVOC_OO_000412 OVOC_OO_000413 OVOC_OO_000414 OVOC_OO_000415 OVOC_OO_000416 OVOC_OO_000417 OVOC_OO_000418 OVOC_OO_000419 OVOC_OO_000420 OVOC_OO_000421 OVOC_OO_000422 OVOC_OO_000423 OVOC_OO_000424 OVOC_OO_000425 OVOC_OO_000426 OVOC_OO_000427 OVOC_OO_000428 OVOC_OO_000429 OVOC_OO_000430 OVOC_OO_000431 OVOC_OO_000432 OVOC_OO_000433 OVOC_OO_000434 OVOC_OO_000435 OVOC_OO_000436 OVOC_OO_000437 OVOC_OO_000438 OVOC_OO_000439 OVOC_OO_000440 OVOC_OO_000441 OVOC_OO_000442 OVOC_OO_000443 OVOC_OO_000444 OVOC_OO_000445 OVOC_OO_000446 OVOC_OO_000447 OVOC_OO_000448 OVOC_OO_000449 OVOC_OO_000450 OVOC_OO_000451 OVOC_OO_000452 OVOC_OO_000453 OVOC_OO_000454 OVOC_OO_000455 OVOC_OO_000456 OVOC_OO_000457 OVOC_OO_000458 OVOC_OO_000459 OVOC_OO_000460 OVOC_OO_000461 OVOC_OO_000462 OVOC_OO_000463 OVOC_OO_000464 OVOC_OO_000465 OVOC_OO_000466 OVOC_OO_000467 OVOC_OO_000468 OVOC_OO_000469 OVOC_OO_000470 OVOC_OO_000471 OVOC_OO_000472 OVOC_OO_000473 OVOC_OO_000474 OVOC_OO_000475 OVOC_OO_000476 OVOC_OO_000477 OVOC_OO_000478 OVOC_OO_000479 OVOC_OO_000480 OVOC_OO_000481 OVOC_OO_000482 OVOC_OO_000483 OVOC_OO_000484 OVOC_OO_000485 OVOC_OO_000486 OVOC_OO_000487 OVOC_OO_000488 OVOC_OO_000489 OVOC_OO_000490 OVOC_OO_000491 OVOC_OO_000492 OVOC_OO_000493 OVOC_OO_000494 OVOC_OO_000495 OVOC_OO_000496 OVOC_OO_000497 OVOC_OO_000498 OVOC_OO_000499 OVOC_OO_000500 OVOC_OO_000501 OVOC_OO_000502 OVOC_OO_000503 OVOC_OO_000504 OVOC_OO_000505 OVOC_OO_000506 OVOC_OO_000507 OVOC_OO_000508 OVOC_OO_000509 OVOC_OO_000510 OVOC_OO_000511 OVOC_OO_000512 OVOC_OO_000513 OVOC_OO_000514 OVOC_OO_000515 OVOC_OO_000516 OVOC_OO_000517 OVOC_OO_000518 OVOC_OO_000519 OVOC_OO_000520 OVOC_OO_000521 OVOC_OO_000522 OVOC_OO_000523 OVOC_OO_000525 OVOC_OO_000526 OVOC_OO_000527 OVOC_OO_000528 OVOC_OO_000529 OVOC_OO_000530 OVOC_OO_000531 OVOC_OO_000532 OVOC_OO_000533 OVOC_OO_000534 OVOC_OO_000535 OVOC_OO_000536 OVOC_OO_000537 OVOC_OO_000538 OVOC_OO_000539 OVOC_OO_000540 OVOC_OO_000541 OVOC_OO_000542 OVOC_OO_000543 OVOC_OO_000544 OVOC_OO_000545 OVOC_OO_000546 OVOC_OO_000547 OVOC_OO_000548 OVOC_OO_000549 OVOC_OO_000550 OVOC_OO_000551 OVOC_OO_000552 OVOC_OO_000553 OVOC_OO_000554 OVOC_OO_000555 OVOC_OO_000556 OVOC_OO_000557 OVOC_OO_000558 OVOC_OO_000559 OVOC_OO_000560 OVOC_OO_000561 OVOC_OO_000562 OVOC_OO_000563 OVOC_OO_000564 OVOC_OO_000565 OVOC_OO_000566 OVOC_OO_000567 OVOC_OO_000568 OVOC_OO_000569 OVOC_OO_000570 OVOC_OO_000571 OVOC_OO_000572 OVOC_OO_000573 OVOC_OO_000574 OVOC_OO_000575 OVOC_OO_000576 OVOC_OO_000577 OVOC_OO_000578 OVOC_OO_000579 OVOC_OO_000580 OVOC_OO_000581 OVOC_OO_000582 OVOC_OO_000583 OVOC_OO_000584 OVOC_OO_000585 OVOC_OO_000586 OVOC_OO_000587 OVOC_OO_000588 OVOC_OO_000589 OVOC_OO_000590 OVOC_OO_000591 OVOC_OO_000592 OVOC_OO_000593 OVOC_OO_000594 OVOC_OO_000595 OVOC_OO_000596 OVOC_OO_000597 OVOC_OO_000598 OVOC_OO_000599 OVOC_OO_000600 OVOC_OO_000601 OVOC_OO_000602 OVOC_OO_000603 OVOC_OO_000604 OVOC_OO_000605 OVOC_OO_000606 OVOC_OO_000607 OVOC_OO_000608 OVOC_OO_000609 OVOC_OO_000610 OVOC_OO_000611 OVOC_OO_000612 OVOC_OO_000613 OVOC_OO_000614 OVOC_OO_000616 OVOC_OO_000617 OVOC_OO_000618 OVOC_OO_000619 OVOC_OO_000620 OVOC_OO_000621 OVOC_OO_000622 OVOC_OO_000623 OVOC_OO_000624 OVOC_OO_000625 OVOC_OO_000626 OVOC_OO_000627 OVOC_OO_000628 OVOC_OO_000629 OVOC_OO_000630 OVOC_OO_000631 OVOC_OO_000632 OVOC_OO_000633 OVOC_OO_000634 OVOC_OO_000635 OVOC_OO_000636 OVOC_OO_000637 OVOC_OO_000638 OVOC_OO_000639 OVOC_OO_000640 OVOC_OO_000641 OVOC_OO_000642 OVOC_OO_000643 OVOC_OO_000644 OVOC_OO_000645 OVOC_OO_000646 OVOC_OO_000647 OVOC_OO_000648 OVOC_OO_000649 OVOC_OO_000650 OVOC_OO_000651 OVOC_OO_000652 OVOC_OO_000653 OVOC_OO_000654 OVOC_OO_000655 OVOC_OO_000656 OVOC_OO_000657 OVOC_OO_000658 OVOC_OO_000659 OVOC_OO_000660 OVOC_OO_000661 OVOC_OO_000662 OVOC_OO_000663 OVOC_OO_000664 OVOC_OO_000665 OVOC_OO_000666 OVOC_OO_000667 OVOC_OO_000668 OVOC_OO_000669 OVOC_OO_000670 OVOC_OO_000671 OVOC_OO_000672 OVOC_OO_000673 OVOC_OO_000674 OVOC_OO_000675 OVOC_OO_000676 OVOC_OO_000677 OVOC_OO_000678 OVOC_OO_000679 OVOC_OO_000680 OVOC_OO_000681 OVOC_OO_000682 OVOC_OO_000683 OVOC_OO_000684 OVOC_OO_000685 OVOC_OO_000686 OVOC_OO_000687 OVOC_OO_000688 OVOC_OO_000689 OVOC_OO_000690 OVOC_OO_000691 OVOC_OO_000692 OVOC_OO_000693 OVOC_OO_000694 OVOC_OO_000695 OVOC_OO_000696 OVOC_OO_000697 OVOC_OO_000698 OVOC_OO_000699 OVOC_OO_000700 OVOC_OO_000701 OVOC_OO_000702 OVOC_OO_000703 OVOC_OO_000704 OVOC_OO_000705 OVOC_OO_000706 OVOC_OO_000707  > $i\.nuc.bam

gatk -T HaplotypeCaller -R $REF -ERC GVCF -variant_index_type LINEAR -variant_index_parameter 128000 -I $i\.nuc.bam -o $i\.nuc.HC.gvcf

done
